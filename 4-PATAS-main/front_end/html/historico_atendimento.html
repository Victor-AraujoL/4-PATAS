<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Associa√ß√£o 4 Patas - Meus Atendimentos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

            <link rel="stylesheet" type="text/css" href="../css/historico_atendimento.css"/>
</head>
<body>
    <!-- Decorative paws -->
    <div class="paws paw1">üêæ</div>
    <div class="paws paw2">üêæ</div>
    <div class="paws paw3">üêæ</div>

    <!-- Header -->
    <header class="main-header">
        <div class="main-container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-placeholder">
                        <i class="fas fa-paw"></i>
                    </div>
                    <div>
                        <h1 class="header-title">Meus Atendimentos</h1>
                        <p class="header-subtitle">Associa√ß√£o 4 Patas</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-custom-secondary me-2" onclick="window.location.href='index.html';">
                        <i class="fas fa-arrow-left me-2"></i>
                        Voltar ao Menu
                    </button>
                    <button class="btn btn-custom-primary me-2" onclick="window.location.href='cadastro_atendimento.html';">
                        <i class="fas fa-plus me-2"></i>
                        Cadastrar atendimento
                    </button>
                    <button class="btn btn-custom-secondary" onclick="exportToPDF()">
                        <i class="fas fa-download me-2"></i>
                        Exportar PDF
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Alert -->
        <div id="alert" class="alert d-none mt-3" role="alert"></div>

        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="stats-card">
                    <div class="stats-number" id="total-appointments">5</div>
                    <div class="stats-label">Total de Atendimentos</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stats-card">
                    <div class="stats-number" id="recent-appointments">2</div>
                    <div class="stats-label">Este M√™s</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stats-card">
                    <div class="stats-number" id="pets-count">3</div>
                    <div class="stats-label">Pets Atendidos</div>
                </div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-section">
            <div class="row">
                <div class="col-md-10">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" id="search-input" class="form-control search-input border-start-0" 
                               placeholder="Buscar por pet, veterin√°rio, diagn√≥stico, medicamento...">
                    </div>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-custom-primary w-100" onclick="filterAppointments()">
                        <i class="fas fa-search me-2"></i>
                        Buscar
                    </button>
                </div>
            </div>
        </div>

        <!-- DESKTOP VIEW: Table -->
        <div class="appointments-container-desktop">
            <div class="appointments-table">
                <div class="table-header">
                    <h3>
                        <i class="fas fa-history"></i>
                        Hist√≥rico de Consultas Veterin√°rias
                    </h3>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Pet</th>
                                <th>Veterin√°rio</th>
                                <th>Peso (kg)</th>
                                <th>Diagn√≥stico</th>
                                <th>Status</th>
                                <th width="100">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="appointments-table-body">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- MOBILE VIEW: Cards -->
        <div class="appointments-container-mobile">
            <div id="appointments-cards-container">
                <!-- Cards ser√£o inseridos via JavaScript -->
            </div>
        </div>

        <!-- Pagination -->
        <nav>
            <ul class="pagination">
                <li class="page-item">
                    <a class="page-link" href="#" id="prev-page"><i class="fas fa-chevron-left"></i></a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#" class="page-number">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" class="page-number">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" class="page-number">3</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" id="next-page"><i class="fas fa-chevron-right"></i></a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Modal Detalhes do Atendimento -->
    <div class="modal fade" id="appointmentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalhes da Consulta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-primary fw-bold">Data e Hora</label>
                            <p id="detail-datetime" class="form-control-static fs-5"></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-primary fw-bold">Pet Atendido</label>
                            <p id="detail-pet" class="form-control-static fs-5"></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-primary fw-bold">Veterin√°rio</label>
                            <p id="detail-collaborator" class="form-control-static"></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-primary fw-bold">Peso na Consulta</label>
                            <p id="detail-weight" class="form-control-static"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-primary fw-bold">Medicamento Prescrito</label>
                        <p id="detail-medication" class="form-control-static"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-primary fw-bold">Diagn√≥stico</label>
                        <p id="detail-diagnosis" class="form-control-static bg-light p-3 rounded"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-primary fw-bold">Observa√ß√µes e Recomenda√ß√µes</label>
                        <p id="detail-observation" class="form-control-static bg-light p-3 rounded"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Fechar
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-download-report">
                        <i class="fas fa-download me-2"></i>Baixar Relat√≥rio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Dados simulados de atendimentos do usu√°rio
        const appointmentsMockData = [
            {
                id: 1,
                idPet: 101,
                nomePet: "Rex",
                idColaborador: 201,
                nomeColaborador: "Dr. Carlos Silva",
                peso: 12.5,
                dataHora: "2025-05-16T14:30:00",
                medicamento: "Antibi√≥tico canino (Amoxicilina)",
                diagnostico: "Infec√ß√£o cut√¢nea leve na regi√£o dorsal. Vermelhid√£o e irrita√ß√£o da pele causada por alergia sazonal.",
                observacao: "Retorno em 7 dias para reavalia√ß√£o. Aplicar pomada 2x ao dia. Evitar banhos por 3 dias. Manter ambiente limpo e seco.",
                dataCadastro: "2025-05-16T09:15:00",
                status: "Recente"
            },
            {
                id: 2,
                idPet: 102,
                nomePet: "Luna",
                idColaborador: 202,
                nomeColaborador: "Dra. Ana Oliveira",
                peso: 4.2,
                dataHora: "2025-05-16T10:15:00",
                medicamento: "Antipulgas t√≥pico (Frontline)",
                diagnostico: "Infesta√ß√£o moderada de pulgas. Presen√ßa de ovos e pulgas adultas no pelo.",
                observacao: "Aplicar solu√ß√£o t√≥pica 1x por m√™s. Higienizar ambiente dom√©stico. Lavar roupas de cama em √°gua quente.",
                dataCadastro: "2025-05-16T08:45:00",
                status: "Recente"
            },
            {
                id: 3,
                idPet: 103,
                nomePet: "Milo",
                idColaborador: 201,
                nomeColaborador: "Dr. Carlos Silva",
                peso: 8.7,
                dataHora: "2025-04-17T09:00:00",
                medicamento: "Anti-inflamat√≥rio (Meloxicam)",
                diagnostico: "Trauma leve na pata dianteira direita. Incha√ßo e sensibilidade na articula√ß√£o.",
                observacao: "Repouso recomendado por 5 dias. Evitar corridas e saltos. Compressa fria 3x ao dia por 10 minutos.",
                dataCadastro: "2025-04-15T16:20:00",
                status: "Hist√≥rico"
            },
            {
                id: 4,
                idPet: 104,
                nomePet: "Bella",
                idColaborador: 203,
                nomeColaborador: "Dr. Marcos Santos",
                peso: 15.3,
                dataHora: "2025-03-18T13:45:00",
                medicamento: "Verm√≠fugo (Drontal Plus)",
                diagnostico: "Verminose intestinal diagnosticada atrav√©s de exame de fezes. Presen√ßa de ovos de √°scaris.",
                observacao: "Repetir dose em 15 dias. Coletar nova amostra de fezes ap√≥s tratamento para confirmar efic√°cia.",
                dataCadastro: "2025-03-17T11:10:00",
                status: "Hist√≥rico"
            },
            {
                id: 5,
                idPet: 105,
                nomePet: "Thor",
                idColaborador: 202,
                nomeColaborador: "Dra. Ana Oliveira",
                peso: 25.8,
                dataHora: "2025-02-18T16:30:00",
                medicamento: "Suplemento vitam√≠nico B12",
                diagnostico: "Anemia leve detectada em exame de sangue. N√≠veis baixos de hemoglobina e ferro.",
                observacao: "Incluir suplemento na dieta di√°ria. Aumentar consumo de prote√≠nas. Retorno em 30 dias para novo hemograma.",
                dataCadastro: "2025-02-17T14:50:00",
                status: "Hist√≥rico"
            }
        ];

        // Elementos DOM
        const searchInput = document.getElementById('search-input');
        const alertBox = document.getElementById('alert');
        const appointmentsTableBody = document.getElementById('appointments-table-body');
        const appointmentsCardsContainer = document.getElementById('appointments-cards-container');
        const appointmentModal = new bootstrap.Modal(document.getElementById('appointmentModal'));

        // Formata√ß√£o da data
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Mostrar alerta
        function showAlert(message, type) {
            alertBox.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
            `;
            alertBox.className = `alert alert-${type}`;
            alertBox.classList.remove('d-none');
            
            setTimeout(() => {
                alertBox.classList.add('d-none');
            }, 4000);

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const recentAppointments = appointmentsMockData.filter(appointment => {
                const appointmentDate = new Date(appointment.dataHora);
                return appointmentDate.getMonth() === currentMonth && appointmentDate.getFullYear() === currentYear;
            });

            const uniquePets = [...new Set(appointmentsMockData.map(a => a.nomePet))];

            document.getElementById('total-appointments').textContent = appointmentsMockData.length;
            document.getElementById('recent-appointments').textContent = recentAppointments.length;
            document.getElementById('pets-count').textContent = uniquePets.length;
        }

        // Renderizar tabela (Desktop)
        function renderAppointmentsTable(appointments) {
            appointmentsTableBody.innerHTML = '';
            
            appointments.forEach(appointment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${formatDateTime(appointment.dataHora)}</strong></td>
                    <td>${appointment.nomePet}</td>
                    <td>${appointment.nomeColaborador}</td>
                    <td>${appointment.peso.toFixed(1)} kg</td>
                    <td>
                        <span title="${appointment.diagnostico}" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;">
                            ${appointment.diagnostico}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${appointment.status.toLowerCase()}">
                            ${appointment.status}
                        </span>
                    </td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewAppointment(${appointment.id})" title="Ver Detalhes">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn btn-download" onclick="downloadReport(${appointment.id})" title="Baixar Relat√≥rio">
                            <i class="fas fa-download"></i>
                        </button>
                    </td>
                `;
                appointmentsTableBody.appendChild(row);
            });
        }

        // Renderizar cards (Mobile)
        function renderAppointmentsCards(appointments) {
            appointmentsCardsContainer.innerHTML = '';
            
            appointments.forEach(appointment => {
                const card = document.createElement('div');
                card.className = 'appointment-card-mobile';
                card.innerHTML = `
                    <div class="appointment-header-mobile">
                        <h4 class="appointment-title-mobile">${appointment.nomePet}</h4>
                        <span class="status-badge status-${appointment.status.toLowerCase()}">
                            ${appointment.status}
                        </span>
                    </div>
                    
                    <div class="appointment-details-mobile">
                        <div class="appointment-detail-mobile">
                            <span class="appointment-detail-label-mobile">Data/Hora</span>
                            <span class="appointment-detail-value-mobile">${formatDateTime(appointment.dataHora)}</span>
                        </div>
                        <div class="appointment-detail-mobile">
                            <span class="appointment-detail-label-mobile">Veterin√°rio</span>
                            <span class="appointment-detail-value-mobile">${appointment.nomeColaborador}</span>
                        </div>
                        <div class="appointment-detail-mobile">
                            <span class="appointment-detail-label-mobile">Peso</span>
                            <span class="appointment-detail-value-mobile">${appointment.peso.toFixed(1)} kg</span>
                        </div>
                        <div class="appointment-detail-mobile">
                            <span class="appointment-detail-label-mobile">Medicamento</span>
                            <span class="appointment-detail-value-mobile">${appointment.medicamento}</span>
                        </div>
                        <div class="appointment-detail-mobile">
                            <span class="appointment-detail-label-mobile">Diagn√≥stico</span>
                            <span class="appointment-detail-value-mobile">${appointment.diagnostico.substring(0, 80)}...</span>
                        </div>
                    </div>
                    
                    <div class="appointment-actions-mobile">
                        <button class="action-btn btn-view" onclick="viewAppointment(${appointment.id})" title="Ver Detalhes">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn btn-download" onclick="downloadReport(${appointment.id})" title="Baixar Relat√≥rio">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                `;
                appointmentsCardsContainer.appendChild(card);
            });
        }

        // Renderizar atendimentos (ambas as views)
        function renderAppointments(appointments = appointmentsMockData) {
            renderAppointmentsTable(appointments);
            renderAppointmentsCards(appointments);
        }

        // Filtrar atendimentos
        function filterAppointments() {
            const searchTerm = searchInput.value.toLowerCase();
            
            if (!searchTerm) {
                renderAppointments();
                return;
            }
            
            const filteredAppointments = appointmentsMockData.filter(appointment => {
                return (
                    appointment.nomePet.toLowerCase().includes(searchTerm) ||
                    appointment.nomeColaborador.toLowerCase().includes(searchTerm) ||
                    appointment.diagnostico.toLowerCase().includes(searchTerm) ||
                    appointment.medicamento.toLowerCase().includes(searchTerm)
                );
            });
            
            renderAppointments(filteredAppointments);
            
            if (filteredAppointments.length === 0) {
                showAlert('Nenhum atendimento encontrado com os termos de busca informados.', 'warning');
            } else {
                showAlert(`${filteredAppointments.length} atendimento(s) encontrado(s).`, 'success');
            }
        }

        // Visualizar atendimento
        function viewAppointment(appointmentId) {
            const appointment = appointmentsMockData.find(a => a.id === appointmentId);
            if (appointment) {
                document.getElementById('detail-datetime').textContent = formatDateTime(appointment.dataHora);
                document.getElementById('detail-pet').textContent = appointment.nomePet;
                document.getElementById('detail-collaborator').textContent = appointment.nomeColaborador;
                document.getElementById('detail-weight').textContent = `${appointment.peso.toFixed(1)} kg`;
                document.getElementById('detail-medication').textContent = appointment.medicamento;
                document.getElementById('detail-diagnosis').textContent = appointment.diagnostico;
                document.getElementById('detail-observation').textContent = appointment.observacao;
                
                document.getElementById('btn-download-report').onclick = () => {
                    downloadReport(appointmentId);
                };
                
                appointmentModal.show();
            }
        }

        // Baixar relat√≥rio
        function downloadReport(appointmentId) {
            const appointment = appointmentsMockData.find(a => a.id === appointmentId);
            if (appointment) {
                showAlert(`Baixando relat√≥rio da consulta de ${appointment.nomePet} - ${formatDate(appointment.dataHora)}`, 'success');
                // Aqui seria implementada a l√≥gica real de download
            }
        }

        // Exportar para PDF
        function exportToPDF() {
            showAlert('Exportando hist√≥rico completo para PDF...', 'info');
            // Simular processo de exporta√ß√£o
            setTimeout(() => {
                showAlert('Hist√≥rico exportado com sucesso!', 'success');
            }, 2000);
        }

        // Event Listeners
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                filterAppointments();
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            renderAppointments();
            
        });
    </script>
</body>
</html>
