<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Associa√ß√£o 4 Patas - Cadastro de Atendimento</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                <link rel="stylesheet" type="text/css" href="css/cadastro_atendimento.css"/>

</head>
<body>
    <!-- Decorative paws -->
    <div class="paws paw1">üêæ</div>
    <div class="paws paw2">üêæ</div>
    <div class="paws paw3">üêæ</div>

    <!-- Header -->
    <header class="main-header">
        <div class="main-container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-placeholder">
                        <i class="fas fa-paw"></i>
                    </div>
                    <div>
                        <h1 class="header-title">Cadastro de Atendimento</h1>
                        <p class="header-subtitle">Associa√ß√£o 4 Patas</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-custom-secondary" onclick="window.location.href='index.html';">
                        <i class="fas fa-arrow-left me-2"></i>
                        Voltar ao Menu
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Alert -->
        <div id="alert" class="alert d-none mt-3" role="alert"></div>

        <!-- Formul√°rio de Cadastro -->
        <div class="content-card">
            <div class="card-header-custom">
                <h3>
                    <i class="fas fa-user-md"></i>
                    Novo Atendimento Veterin√°rio
                </h3>
            </div>
            <div class="card-body-custom">
                <form id="form-atendimento" novalidate>
                    <!-- Primeira linha: Pet e Colaborador -->
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3">
                            <label for="pet" class="form-label form-label-custom required">Pet</label>
                            <select id="pet" name="idPet" class="form-control form-control-custom" required>
                                <option value="">Selecione o Pet</option>
                            </select>
                            <div class="invalid-feedback">Por favor, selecione um pet.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="colaborador" class="form-label form-label-custom required">Veterin√°rio</label>
                            <select id="colaborador" name="idColaborador" class="form-control form-control-custom" required>
                                <option value="">Selecione o Veterin√°rio</option>
                            </select>
                            <div class="invalid-feedback">Por favor, selecione um veterin√°rio.</div>
                        </div>
                    </div>
                    
                    <!-- Segunda linha: Respons√°vel e Peso -->
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3">
                            <label for="usuario" class="form-label form-label-custom required">Respons√°vel</label>
                            <select id="usuario" name="idUsuario" class="form-control form-control-custom" required>
                                <option value="">Selecione o Respons√°vel</option>
                            </select>
                            <div class="invalid-feedback">Por favor, selecione um respons√°vel.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="peso" class="form-label form-label-custom required">Peso (kg)</label>
                            <input type="number" id="peso" name="peso" class="form-control form-control-custom" 
                                   step="0.01" min="0" placeholder="Ex: 12.5" required>
                            <div class="invalid-feedback">Por favor, informe o peso do animal.</div>
                        </div>
                    </div>
                    
                    <!-- Terceira linha: Data/Hora e Medicamento -->
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3">
                            <label for="dataHora" class="form-label form-label-custom required">Data e Hora</label>
                            <input type="datetime-local" id="dataHora" name="dataHora" class="form-control form-control-custom" required>
                            <div class="invalid-feedback">Por favor, selecione uma data e hora.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="medicamento" class="form-label form-label-custom">Medicamento</label>
                            <input type="text" id="medicamento" name="medicamento" class="form-control form-control-custom" 
                                   placeholder="Ex: Antibi√≥tico, Verm√≠fugo...">
                        </div>
                    </div>
                    
                    <!-- Diagn√≥stico -->
                    <div class="mb-3">
                        <label for="diagnostico" class="form-label form-label-custom required">Diagn√≥stico</label>
                        <textarea id="diagnostico" name="diagnostico" class="form-control form-control-custom" 
                                  rows="4" placeholder="Descreva o diagn√≥stico detalhado..." required></textarea>
                        <div class="invalid-feedback">Por favor, informe o diagn√≥stico.</div>
                    </div>
                    
                    <!-- Observa√ß√µes -->
                    <div class="mb-4">
                        <label for="observacao" class="form-label form-label-custom">Observa√ß√µes</label>
                        <textarea id="observacao" name="observacao" class="form-control form-control-custom" 
                                  rows="3" placeholder="Observa√ß√µes adicionais (opcional)..."></textarea>
                    </div>
                    
                    <!-- Bot√µes de A√ß√£o -->
                    <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
                        <button type="button" id="btn-cancelar" class="btn btn-clear">
                            <i class="fas fa-eraser me-2"></i>
                            Limpar Formul√°rio
                        </button>
                        <button type="submit" class="btn btn-save">
                            <i class="fas fa-save me-2"></i>
                            Salvar Atendimento
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar A√ß√£o</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-question-circle text-warning" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p id="modal-message">Tem certeza que deseja realizar esta a√ß√£o?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-confirm-action">
                        <i class="fas fa-check me-2"></i>Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Dados de exemplo para carregar os selects
        const pets = [
            { id: 101, nome: "Rex", especie: "Cachorro", raca: "Labrador" },
            { id: 102, nome: "Luna", especie: "Gato", raca: "Siam√™s" },
            { id: 103, nome: "Milo", especie: "Cachorro", raca: "Bulldog" },
            { id: 104, nome: "Bella", especie: "Cachorro", raca: "Golden Retriever" },
            { id: 105, nome: "Thor", especie: "Cachorro", raca: "Pastor Alem√£o" },
            { id: 106, nome: "Nina", especie: "Gato", raca: "Persa" },
            { id: 107, nome: "Max", especie: "Cachorro", raca: "Golden Retriever" }
        ];
        
        const colaboradores = [
            { id: 201, nome: "Dr. Carlos Silva", cargo: "Veterin√°rio" },
            { id: 202, nome: "Dra. Ana Oliveira", cargo: "Veterin√°rio" },
            { id: 203, nome: "Dr. Marcos Santos", cargo: "Veterin√°rio" },
            { id: 204, nome: "Dra. Juliana Costa", cargo: "Veterin√°rio" },
            { id: 205, nome: "Dr. Roberto Almeida", cargo: "Veterin√°rio" }
        ];
        
        const usuarios = [
            { id: 301, nome: "Maria Silva", telefone: "(11) 98765-4321" },
            { id: 302, nome: "Jo√£o Pereira", telefone: "(11) 91234-5678" },
            { id: 303, nome: "Fernanda Costa", telefone: "(11) 99876-5432" },
            { id: 304, nome: "Luciana Mendes", telefone: "(11) 94567-8901" },
            { id: 305, nome: "Ricardo Souza", telefone: "(11) 92345-6789" },
            { id: 306, nome: "Ana Sousa", telefone: "(11) 96666-6666" },
            { id: 307, nome: "Carlos Ferreira", telefone: "(11) 95555-5555" }
        ];

        // Elementos DOM
        const alertBox = document.getElementById('alert');
        const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
        let pendingAction = null;

        // Mostrar alerta
        function showAlert(message, type) {
            alertBox.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'} me-2"></i>
                ${message}
            `;
            alertBox.className = `alert alert-${type}`;
            alertBox.classList.remove('d-none');
            
            setTimeout(() => {
                alertBox.classList.add('d-none');
            }, 4000);

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Fun√ß√£o para carregar os selects com os dados
        function carregarSelects() {
            const selectPet = document.getElementById('pet');
            const selectColaborador = document.getElementById('colaborador');
            const selectUsuario = document.getElementById('usuario');
            
            // Carregar pets
            pets.forEach(pet => {
                const option = document.createElement('option');
                option.value = pet.id;
                option.textContent = `${pet.nome} (${pet.especie} - ${pet.raca})`;
                selectPet.appendChild(option);
            });
            
            // Carregar colaboradores
            colaboradores.forEach(colaborador => {
                const option = document.createElement('option');
                option.value = colaborador.id;
                option.textContent = `${colaborador.nome} (${colaborador.cargo})`;
                selectColaborador.appendChild(option);
            });
            
            // Carregar usu√°rios
            usuarios.forEach(usuario => {
                const option = document.createElement('option');
                option.value = usuario.id;
                option.textContent = `${usuario.nome} - ${usuario.telefone}`;
                selectUsuario.appendChild(option);
            });
        }
        
        // Fun√ß√£o para definir a data e hora atual como valor padr√£o
        function definirDataHoraAtual() {
            const dataHoraInput = document.getElementById('dataHora');
            const agora = new Date();
            
            // Formatar a data para o formato esperado pelo input datetime-local
            const ano = agora.getFullYear();
            const mes = String(agora.getMonth() + 1).padStart(2, '0');
            const dia = String(agora.getDate()).padStart(2, '0');
            const hora = String(agora.getHours()).padStart(2, '0');
            const minuto = String(agora.getMinutes()).padStart(2, '0');
            
            const dataFormatada = `${ano}-${mes}-${dia}T${hora}:${minuto}`;
            dataHoraInput.value = dataFormatada;
        }
        
        // Fun√ß√£o para validar o formul√°rio
        function validarFormulario(form) {
            let formValido = true;
            
            // Limpar valida√ß√µes anteriores
            form.querySelectorAll('.is-invalid').forEach(campo => {
                campo.classList.remove('is-invalid');
            });
            
            // Verificar campos obrigat√≥rios
            form.querySelectorAll('[required]').forEach(campo => {
                if (!campo.value.trim()) {
                    campo.classList.add('is-invalid');
                    formValido = false;
                } else {
                    campo.classList.remove('is-invalid');
                }
            });
            
            // Valida√ß√£o espec√≠fica para o campo de peso
            const pesoInput = form.querySelector('#peso');
            if (pesoInput.value && parseFloat(pesoInput.value) <= 0) {
                pesoInput.classList.add('is-invalid');
                const feedback = pesoInput.nextElementSibling;
                feedback.textContent = "O peso deve ser maior que zero.";
                formValido = false;
            }
            
            return formValido;
        }
        
        // Fun√ß√£o para salvar o atendimento
        function salvarAtendimento(form) {
            // Mostrar loading
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Salvando...';
            submitBtn.disabled = true;
            
            // Coletar os dados do formul√°rio
            const formData = new FormData(form);
            const atendimento = {
                idPet: formData.get('idPet'),
                idColaborador: formData.get('idColaborador'),
                idUsuario: formData.get('idUsuario'),
                peso: formData.get('peso'),
                dataHora: formData.get('dataHora'),
                medicamento: formData.get('medicamento'),
                diagnostico: formData.get('diagnostico'),
                observacao: formData.get('observacao'),
                dataCadastro: new Date().toISOString()
            };
            
            // Simular o envio para o servidor
            console.log('Atendimento a ser salvo:', atendimento);
            
            // Simular sucesso ap√≥s 2 segundos
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                showAlert('Atendimento cadastrado com sucesso!', 'success');
                
                // Limpar formul√°rio ap√≥s sucesso
                setTimeout(() => {
                    form.reset();
                    definirDataHoraAtual();
                    showAlert('Pronto para um novo atendimento!', 'success');
                }, 1500);
            }, 2000);
        }

        // Fun√ß√£o para confirmar a√ß√£o
        function confirmarAcao(message, callback) {
            document.getElementById('modal-message').textContent = message;
            document.getElementById('btn-confirm-action').onclick = () => {
                confirmModal.hide();
                callback();
            };
            confirmModal.show();
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            carregarSelects();
            definirDataHoraAtual();
            
            const form = document.getElementById('form-atendimento');
            
            // Listener para o evento de submit do formul√°rio
            form.addEventListener('submit', event => {
                event.preventDefault();
                
                if (validarFormulario(form)) {
                    confirmarAcao('Tem certeza que deseja salvar este atendimento?', () => {
                        salvarAtendimento(form);
                    });
                } else {
                    showAlert('Por favor, corrija os campos destacados em vermelho.', 'danger');
                }
            });
            
            // Listener para o bot√£o de limpar formul√°rio
            document.getElementById('btn-cancelar').addEventListener('click', () => {
                confirmarAcao('Tem certeza que deseja limpar todos os campos do formul√°rio?', () => {
                    form.reset();
                    definirDataHoraAtual();
                    // Remover classes de valida√ß√£o
                    form.querySelectorAll('.is-invalid').forEach(campo => {
                        campo.classList.remove('is-invalid');
                    });
                    showAlert('Formul√°rio limpo com sucesso!', 'success');
                });
            });
            
            // Valida√ß√£o em tempo real ao sair do campo
            form.querySelectorAll('input, select, textarea').forEach(campo => {
                campo.addEventListener('blur', () => {
                    if (campo.hasAttribute('required') && !campo.value.trim()) {
                        campo.classList.add('is-invalid');
                    } else {
                        campo.classList.remove('is-invalid');
                    }
                });
                
                // Remover valida√ß√£o ao digitar
                campo.addEventListener('input', () => {
                    if (campo.classList.contains('is-invalid') && campo.value.trim()) {
                        campo.classList.remove('is-invalid');
                    }
                });
            });
            
            // Valida√ß√£o espec√≠fica para o campo de peso
            const pesoInput = document.getElementById('peso');
            pesoInput.addEventListener('blur', () => {
                if (pesoInput.value && parseFloat(pesoInput.value) <= 0) {
                    pesoInput.classList.add('is-invalid');
                    const feedback = pesoInput.nextElementSibling;
                    feedback.textContent = "O peso deve ser maior que zero.";
                }
            });
        });
    </script>
</body>
</html>