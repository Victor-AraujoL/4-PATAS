<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Associação 4 Patas - Cadastro de Atendimento</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/cadastro_atendimento.css"/>
</head>
<body>
    <div class="paws paw1">🐾</div>
    <div class="paws paw2">🐾</div>
    <div class="paws paw3">🐾</div>
    
    <button class="close-button" onclick="window.location.href='index.html';" title="Cancelar e voltar para a página inicial">
        <i class="fas fa-times"></i>
    </button>
    <div class="container">
        <header>
            <img src="assets/logo.png.png" alt="Logo 4 Patas" class="header-logo">
            <h1>Cadastro de Atendimento</h1>
        </header>
        
        <form id="form-atendimento">
            <div class="form-row">
                <div class="form-group">
                    <label for="pet" class="required">Pet</label>
                    <select id="pet" name="idPet" required>
                        <option value="">Selecione o Pet</option>
                        <!-- Dados serão carregados via JavaScript -->
                    </select>
                    <div class="invalid-feedback">Por favor, selecione um pet.</div>
                </div>
                
                <div class="form-group">
                    <label for="colaborador" class="required">Colaborador</label>
                    <select id="colaborador" name="idColaborador" required>
                        <option value="">Selecione o Colaborador</option>
                        <!-- Dados serão carregados via JavaScript -->
                    </select>
                    <div class="invalid-feedback">Por favor, selecione um colaborador.</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="usuario" class="required">Responsável</label>
                    <select id="usuario" name="idUsuario" required>
                        <option value="">Selecione o Responsável</option>
                        <!-- Dados serão carregados via JavaScript -->
                    </select>
                    <div class="invalid-feedback">Por favor, selecione um responsável.</div>
                </div>
                
                <div class="form-group">
                    <label for="peso" class="required">Peso (kg)</label>
                    <input type="number" id="peso" name="peso" step="0.01" min="0" required>
                    <div class="invalid-feedback">Por favor, informe o peso do animal.</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="dataHora" class="required">Data e Hora</label>
                    <input type="datetime-local" id="dataHora" name="dataHora" required>
                    <div class="invalid-feedback">Por favor, selecione uma data e hora.</div>
                </div>
                
                <div class="form-group">
                    <label for="medicamento">Medicamento</label>
                    <input type="text" id="medicamento" name="medicamento">
                </div>
            </div>
            
            <div class="form-group">
                <label for="diagnostico" class="required">Diagnóstico</label>
                <textarea id="diagnostico" name="diagnostico" required></textarea>
                <div class="invalid-feedback">Por favor, informe o diagnóstico.</div>
            </div>
            
            <div class="form-group">
                <label for="observacao">Observação</label>
                <textarea id="observacao" name="observacao"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" id="btn-cancelar" class="btn-secondary"><i class="fas fa-eraser"></i> Limpar Formulário</button>
                <button type="submit" class="btn-primary">Salvar</button>
            </div>
        </form>
    </div>
    
    <script>
        // Dados de exemplo para carregar os selects
        const pets = [
            { id: 101, nome: "Rex", especie: "Cachorro", raca: "Labrador" },
            { id: 102, nome: "Luna", especie: "Gato", raca: "Siamês" },
            { id: 103, nome: "Milo", especie: "Cachorro", raca: "Bulldog" },
            { id: 104, nome: "Bella", especie: "Cachorro", raca: "Golden Retriever" },
            { id: 105, nome: "Thor", especie: "Cachorro", raca: "Pastor Alemão" }
        ];
        
        const colaboradores = [
            { id: 201, nome: "Dr. Carlos Silva", cargo: "Veterinário(a)" },
            { id: 202, nome: "Dra. Ana Oliveira", cargo: "Veterinário(a)" },
            { id: 203, nome: "Dr. Marcos Santos", cargo: "Veterinário(a)" },
            { id: 204, nome: "Juliana Costa", cargo: "Auxiliar Veterinário" },
            { id: 205, nome: "Roberto Almeida", cargo: "Recepcionista" }
        ];
        
        const usuarios = [
            { id: 301, nome: "Maria Silva", telefone: "(11) 98765-4321" },
            { id: 302, nome: "João Pereira", telefone: "(11) 91234-5678" },
            { id: 303, nome: "Fernanda Costa", telefone: "(11) 99876-5432" },
            { id: 304, nome: "Luciana Mendes", telefone: "(11) 94567-8901" },
            { id: 305, nome: "Ricardo Souza", telefone: "(11) 92345-6789" }
        ];
        
        // Função para carregar os selects com os dados
        function carregarSelects() {
            const selectPet = document.getElementById('pet');
            const selectColaborador = document.getElementById('colaborador');
            const selectUsuario = document.getElementById('usuario');
            
            // Carregar pets
            pets.forEach(pet => {
                const option = document.createElement('option');
                option.value = pet.id;
                option.textContent = `${pet.nome} (${pet.especie} - ${pet.raca})`;
                selectPet.appendChild(option);
            });
            
            // Carregar colaboradores
            colaboradores.forEach(colaborador => {
                const option = document.createElement('option');
                option.value = colaborador.id;
                option.textContent = `${colaborador.nome} (${colaborador.cargo})`;
                selectColaborador.appendChild(option);
            });
            
            // Carregar usuários
            usuarios.forEach(usuario => {
                const option = document.createElement('option');
                option.value = usuario.id;
                option.textContent = `${usuario.nome} - ${usuario.telefone}`;
                selectUsuario.appendChild(option);
            });
        }
        
        // Função para definir a data e hora atual como valor padrão
        function definirDataHoraAtual() {
            const dataHoraInput = document.getElementById('dataHora');
            const agora = new Date();
            
            // Formatar a data para o formato esperado pelo input datetime-local
            const ano = agora.getFullYear();
            const mes = String(agora.getMonth() + 1).padStart(2, '0');
            const dia = String(agora.getDate()).padStart(2, '0');
            const hora = String(agora.getHours()).padStart(2, '0');
            const minuto = String(agora.getMinutes()).padStart(2, '0');
            
            const dataFormatada = `${ano}-${mes}-${dia}T${hora}:${minuto}`;
            dataHoraInput.value = dataFormatada;
        }
        
        // Função para validar o formulário
        function validarFormulario(form) {
            let formValido = true;
            
            // Verificar campos obrigatórios
            form.querySelectorAll('[required]').forEach(campo => {
                if (!campo.value.trim()) {
                    campo.classList.add('is-invalid');
                    formValido = false;
                } else {
                    campo.classList.remove('is-invalid');
                }
            });
            
            // Validação específica para o campo de peso
            const pesoInput = form.querySelector('#peso');
            if (pesoInput.value && parseFloat(pesoInput.value) <= 0) {
                pesoInput.classList.add('is-invalid');
                pesoInput.nextElementSibling.textContent = "O peso deve ser maior que zero.";
                formValido = false;
            }
            
            return formValido;
        }
        
        // Função para salvar o atendimento
        function salvarAtendimento(form) {
            // Aqui você implementaria a lógica para enviar os dados para o servidor
            // Por enquanto, apenas simularemos o envio
            
            // Coletar os dados do formulário
            const formData = new FormData(form);
            const atendimento = {
                idPet: formData.get('idPet'),
                idColaborador: formData.get('idColaborador'),
                idUsuario: formData.get('idUsuario'),
                peso: formData.get('peso'),
                dataHora: formData.get('dataHora'),
                medicamento: formData.get('medicamento'),
                diagnostico: formData.get('diagnostico'),
                observacao: formData.get('observacao'),
                dataCadastro: new Date().toISOString() // Data atual
            };
            
            // Simular o envio para o servidor
            console.log('Atendimento a ser salvo:', atendimento);
            
            // Simular sucesso após 1 segundo
            setTimeout(() => {
                alert('Atendimento cadastrado com sucesso!');
                // Redirecionar para a página de listagem
                window.location.href = 'index.html';
            }, 1000);
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            carregarSelects();
            definirDataHoraAtual();
            
            const form = document.getElementById('form-atendimento');
            
            // Listener para o evento de submit do formulário
            form.addEventListener('submit', event => {
                event.preventDefault();
                
                if (validarFormulario(form)) {
                    salvarAtendimento(form);
                }
            });
            
            // Listener para o botão de limpar formulário
            document.getElementById('btn-cancelar').addEventListener('click', () => {
                form.reset();
                alert('Formulário limpo com sucesso!');
            });
            
            // Validação em tempo real ao sair do campo
            form.querySelectorAll('input, select, textarea').forEach(campo => {
                campo.addEventListener('blur', () => {
                    if (campo.hasAttribute('required') && !campo.value.trim()) {
                        campo.classList.add('is-invalid');
                    } else {
                        campo.classList.remove('is-invalid');
                    }
                });
            });
            
            // Validação específica para o campo de peso
            const pesoInput = document.getElementById('peso');
            pesoInput.addEventListener('blur', () => {
                if (pesoInput.value && parseFloat(pesoInput.value) <= 0) {
                    pesoInput.classList.add('is-invalid');
                    pesoInput.nextElementSibling.textContent = "O peso deve ser maior que zero.";
                }
            });
        });
    </script>
</body>
</html>