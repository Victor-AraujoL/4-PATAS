<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Associação 4 Patas</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
            <link rel="stylesheet" type="text/css" href="css/index.css"/>
    
</head>
<body>
    <!-- Decorative paws -->
    <div class="paws paw1">🐾</div>
    <div class="paws paw2">🐾</div>
    <div class="paws paw3">🐾</div>
    <div class="paws paw4">🐾</div>

    <!-- Sidebar overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <div class="sidebar d-flex flex-column" id="sidebar">
        <!-- Header -->
        <div class="sidebar-header">
            <div class="logo-container">
                <div class="logo-placeholder">
                    <i class="fas fa-paw"></i>
                </div>
            </div>
            <h1 class="sidebar-title">Associação 4 Patas</h1>
            <p class="sidebar-subtitle">Sistema de Gerenciamento</p>
        </div>

        <!-- User Info -->
        <div class="user-info">
            <div class="user-name" id="user-name">Olá, Usuário</div>
            <div class="user-role" id="user-role">Perfil</div>
        </div>

        <!-- Menu -->
        <nav class="sidebar-menu flex-grow-1">
            <a href="index.html" class="menu-item active">
                <i class="fas fa-home"></i><span>Início</span>
            </a>
            <a href="pets.html" class="menu-item">
                <i class="fas fa-paw"></i><span>Pets</span>
            </a>
            <a href="cadastro_atendimento.html" class="menu-item">
                <i class="fas fa-stethoscope"></i><span>Atendimentos</span>
            </a>
            <a href="pesquisar_vacinas.html" class="menu-item">
                <i class="fas fa-syringe"></i><span>Vacinas</span>
            </a>
            <a href="historico_atendimento_admin.html" class="menu-item" data-admin-only="true" id="hist-admin-item">
                <i class="fas fa-clipboard-list"></i><span>Histórico</span>
            </a>
            <a href="historico_atendimento.html" class="menu-item" data-user-only="true" id="hist-user-item" style="display:none;">
                <i class="fas fa-clipboard-list"></i><span>Histórico</span>
            </a>
            <a href="colaboradores.html" class="menu-item" data-admin-only="true">
                <i class="fas fa-user-md"></i><span>Colaboradores</span>
            </a>
            <a href="cadastro_usuario.html" class="menu-item" data-admin-only="true">
                <i class="fas fa-users"></i><span>Usuários</span>
            </a>
        </nav>

        <!-- Logout -->
        <a href="login.html" class="logout" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i><span>Sair</span>
        </a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div></div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Painel de Controle</h1>
            <p class="page-subtitle">Bem-vindo ao sistema de gerenciamento</p>
        </div>

        <!-- Dashboard -->
        <div class="dashboard-container">
            <div class="dashboard-grid" id="dashboardGrid">
                <div class="dashboard-card" onclick="navigateTo('pets.html')">
                    <div class="dashboard-card-content">
                        <i class="fas fa-paw"></i>
                        <div class="card-title">Pets</div>
                        <div class="card-description">Gerenciar cadastro de pets</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('cadastro_atendimento.html')">
                    <div class="dashboard-card-content">
                        <i class="fas fa-stethoscope"></i>
                        <div class="card-title">Atendimentos</div>
                        <div class="card-description">Consultas e tratamentos</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('pesquisar_vacinas.html')">
                    <div class="dashboard-card-content">
                        <i class="fas fa-syringe"></i>
                        <div class="card-title">Vacinas</div>
                        <div class="card-description">Controle de vacinação</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('historico_atendimento_admin.html')" data-admin-only="true" id="card-hist-admin">
                    <div class="dashboard-card-content">
                        <i class="fas fa-clipboard-list"></i>
                        <div class="card-title">Histórico</div>
                        <div class="card-description">Registro de atendimentos</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('historico_atendimento.html')" data-user-only="true" id="card-hist-user" style="display:none;">
                    <div class="dashboard-card-content">
                        <i class="fas fa-clipboard-list"></i>
                        <div class="card-title">Histórico</div>
                        <div class="card-description">Registro de atendimentos</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('colaboradores.html')" data-admin-only="true">
                    <div class="dashboard-card-content">
                        <i class="fas fa-user-md"></i>
                        <div class="card-title">Colaboradores</div>
                        <div class="card-description">Veterinários e equipe</div>
                    </div>
                </div>

                <div class="dashboard-card" onclick="navigateTo('cadastro_usuario.html')" data-admin-only="true">
                    <div class="dashboard-card-content">
                        <i class="fas fa-users"></i>
                        <div class="card-title">Usuários</div>
                        <div class="card-description">Gerenciar contas</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ========== ELEMENTOS DOM ==========
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const dashboardGrid = document.getElementById('dashboardGrid');
        const userNameEl = document.getElementById('user-name');
        const userRoleEl = document.getElementById('user-role');
        const logoutBtn = document.getElementById('logoutBtn');

        // ========== PROTEÇÃO DE LOGIN ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se está logado
            const loggedIn = localStorage.getItem('loggedIn') === 'true';
            if (!loggedIn) {
                window.location.href = 'login.html';
                return;
            }

            initializeUserInterface();
            setupEventListeners();
        });

        // ========== INICIALIZAÇÃO DA INTERFACE ==========
        function initializeUserInterface() {
            // Obter dados do usuário
            const userRaw = localStorage.getItem('user');
            let user = {};
            try { 
                user = JSON.parse(userRaw || '{}'); 
            } catch(e) {
                console.error('Erro ao parsear dados do usuário:', e);
            }
            
            const isAdmin = localStorage.getItem('isAdmin') === 'true';

            // Preencher informações do usuário
            if (userNameEl) {
                userNameEl.textContent = user.nome ? `Olá, ${user.nome}` : 'Olá, Usuário';
            }
            if (userRoleEl) {
                userRoleEl.textContent = isAdmin ? 'Administrador' : 'Usuário';
            }

            // Configurar visibilidade baseada no perfil
            setupRoleBasedVisibility(isAdmin);

            console.log('Interface inicializada para:', isAdmin ? 'Administrador' : 'Usuário');
        }

        // ========== CONFIGURAÇÃO DE VISIBILIDADE POR PERFIL ==========
        function setupRoleBasedVisibility(isAdmin) {
            // Mostrar/ocultar itens do menu
            document.querySelectorAll('[data-admin-only]').forEach(el => {
                el.style.display = isAdmin ? '' : 'none';
            });

            document.querySelectorAll('[data-user-only]').forEach(el => {
                el.style.display = isAdmin ? 'none' : '';
            });

            // Configurar layout do dashboard
            if (dashboardGrid) {
                dashboardGrid.className = isAdmin ? 'dashboard-grid admin-layout' : 'dashboard-grid user-layout';
            }
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Toggle do menu mobile
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleSidebar);
            }

            // Overlay do sidebar
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', closeSidebar);
            }

            // Logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }

            // Fechar sidebar ao redimensionar para desktop
            window.addEventListener('resize', handleWindowResize);
        }

        // ========== FUNÇÕES DO MENU ==========
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('active');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
        }

        function handleWindowResize() {
            if (window.innerWidth > 768) {
                closeSidebar();
            }
        }

        // ========== NAVEGAÇÃO ==========
        function navigateTo(url) {
            // Fechar sidebar se estiver aberto (mobile)
            closeSidebar();
            
            // Navegar após pequeno delay para efeito visual
            setTimeout(() => {
                window.location.href = url;
            }, 200);
        }

        // ========== LOGOUT ==========
        function handleLogout(event) {
            event.preventDefault();
            
            // Confirmar logout
            if (confirm('Tem certeza que deseja sair?')) {
                // Limpar dados da sessão
                localStorage.removeItem('loggedIn');
                localStorage.removeItem('user');
                localStorage.removeItem('isAdmin');
                
                // Redirecionar para login
                window.location.href = 'login.html';
            }
        }

        // ========== ATALHOS DE TECLADO ==========
        document.addEventListener('keydown', function(e) {
            // Ctrl + M para toggle do menu
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                toggleSidebar();
            }
            
            // ESC para fechar sidebar
            if (e.key === 'Escape') {
                closeSidebar();
            }
        });

        // ========== ANIMAÇÕES DE ENTRADA ==========
        function animateCardsOnLoad() {
            const cards = document.querySelectorAll('.dashboard-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${(index + 1) * 0.1}s`;
            });
        }

        // Executar animações após carregamento
        window.addEventListener('load', animateCardsOnLoad);
    </script>
</body>
</html>